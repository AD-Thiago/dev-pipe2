name: "ADC-Agents-Team Pipeline Automation"

on:
  workflow_dispatch:
    inputs:
      stage:
        description: "Est√°gio do pipeline (L1-L9)"
        required: true
      project_name:
        description: "Nome do projeto"
        required: true
      auto_triggered:
        description: "Indica se foi acionado automaticamente"
        required: false
        default: "false"

jobs:
  trigger_stage:
    runs-on: ubuntu-latest
    steps:
      - name: Debug Inputs
        run: echo "Stage=${{ github.event.inputs.stage }}, Project=${{ github.event.inputs.project_name }}"
      
      - name: Set Up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"
      
      - name: Trigger Next Stage
        run: |
          python3 - <<EOF
          import requests
          import os
          
          stage = "${{ github.event.inputs.stage }}"
          project = "${{ github.event.inputs.project_name }}"
          url = os.environ["AUTOMATION_URL"]
          payload = {"action":"trigger_stage","payload":{"stage":stage,"project_name":project}}
          response = requests.post(url, json=payload)
          print(response.text)
          EOF
        env:
          AUTOMATION_URL: ${{ secrets.AUTOMATION_URL }}